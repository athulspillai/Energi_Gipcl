<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIS-New</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="phase1.html">Phase-1</a></li>
                <li><a href="phase2.html">Phase-2</a></li>
                <li><a href="mis.html">MIS</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="header-container">
            <h2 class="table-title">GIPCL-SLPP DSM Monitoring</h2>
            <span class="date-time">
                Date: <span id="current-date" style="padding: 0 15px;"></span>
                Time: <span id="current-time" style="padding: 0 15px;"></span>
                Block No: <span id="block-no" style="padding: 0 15px;"></span>
                Block Time: <span id="block-time" style="padding: 0 15px;"></span>
            </span>
        </div>

        <div class="tables-containerss">
            <table class="Real-Time-table">
                <caption class="Real-Time-caption">Real Time Value</caption>
                <thead class="Real-Time-table-tbody">
                    <tr>
                        <th colspan="3" class="SLPP-Phase-1-caption">
                            SLPP Phase-1</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th class="SLPP-Phase-1-Subheading">MW</th>
                        <th class="SLPP-Phase-1-Subheading">MVAr</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>

                <thead>
                    <tr>
                        <th colspan="3" class="SLPP-Phase-2-caption">
                            SLPP Phase-2</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th class="SLPP-Phase-2-Subheading">MW</th>
                        <th class="SLPP-Phase-2-Subheading">MVAr</th>
                    </tr>
                </thead>
                <tbody class="SLPP-Phase-2">
                    <!-- SLPP Phase-2 data will be populated here -->
                </tbody>

                <thead>
                    <tr>
                        <th colspan="3" class="SLPP-caption">
                            SLPP</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th class="SLPP-Subheading">MW</th>
                        <th class="SLPP-Subheading">MVAr</th>
                    </tr>
                </thead>
                <tbody class="SLPP">

                </tbody>
            </table>

            <table class="Misnew-Current-Blocks-table">

            </table>

            <table class="Misnew-Cumulatives-table">
                <caption class="Misnew-Cumulatives-caption"> Cumm. Upto Pre Blk</caption>
                <thead>
                    <tr>
                        <th></th>
                        <th class="Misnew-Cumulatives-Heading">SLPP-1
                        </th>
                        <th class="Misnew-Cumulatives-Heading">SLPP-2
                        </th>
                        <th class="Misnew-Cumulatives-Heading">SLPP</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>

                <thead>
                    <tr>
                        <th class="Misnew-Cumulatives-Subheading">
                            Reactive Power</th>
                        <th class="Misnew-Cumulatives-Subheading">
                            SLPP-1</th>
                        <th class="Misnew-Cumulatives-Subheading">
                            SLPP-2</th>
                        <th class="Misnew-Cumulatives-Subheading">
                            SLPP</th>
                    </tr>
                </thead>
                <tbody class="REACTIVE-POWER">

                </tbody>
            </table>

        </div>

        <div class="tabless-containerss">
            <table class="Acp-Fuel-Cost-Frequency-table">
                <caption class="Acp-Fuel-Cost-Frequency-caption">
                    Real Time Exp / Imp Data
                </caption>
                <thead>
                    <tr>
                        <th></th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center;">EXP MW</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center;">IMP MW</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center;">MVAR</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center;">VOLT(kV)</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center;">AMP (I)</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center;">PF</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>

            <table class="Normal-Rate-table">
                <caption class="Normal-Rate-caption">
                    ACP / Fuel Cost / Frequency
                </caption>
                <tbody>

                </tbody>
            </table>

        </div>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const currentPage = window.location.pathname.split("/").pop(); // Get the current page name
            const navLinks = document.querySelectorAll("nav ul li a");

            navLinks.forEach(link => {
                // Remove the active class from all links
                link.classList.remove("active");

                // Add the active class to the current link
                if (link.getAttribute("href") === currentPage) {
                    link.classList.add("active");
                }
            });
        });

        function updateDateTime() {
            const now = new Date();
            // Format date as DD/MM/YYYY
            const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-GB', dateOptions);
            // Format time as HH:MM:SS
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const formattedTime = now.toLocaleTimeString('en-GB', timeOptions);
            // Update the HTML elements with the current date and time
            document.getElementById('current-date').textContent = formattedDate;
            document.getElementById('current-time').textContent = formattedTime;
        }

        // Call the function to set the initial date and time
        updateDateTime();
        // Optionally, update the time every second
        setInterval(updateDateTime, 1000);

        // Utility function to format numbers: display up to 4 decimal places only if there's a decimal part, removing trailing zeros
        const formatNumber = (value) => {
            if (value === null || value === undefined || isNaN(Number(value))) {
                return 'undefined';
            }
            const num = Number(value);
            // If the number is an integer, return it as a string
            if (Number.isInteger(num)) {
                return num.toString();
            }
            // For non-integer numbers, use toFixed(4) and remove trailing zeros and decimal point if necessary
            return parseFloat(num.toFixed(4)).toString();
        };

        async function fetchData() {
            try {
                const response = await fetch('/EMS_Network/WebData');
                // Fetch data from both endpoints
                const [webDataResponse, rtDataResponse] = await Promise.all([
                    fetch('/EMS_Network/WebData'),
                    fetch('/EMS_Network/RTWebData')
                ]);

                if (!webDataResponse.ok || !rtDataResponse.ok) {
                    throw new Error('Network response was not ok');
                }

                const webData = await webDataResponse.json();
                const rtData = await rtDataResponse.json();

                console.log('WebData:', webData); // Log the fetched web data
                console.log('RTData:', rtData); // Log the fetched RT data

                const realTimeValue = webData.find(item => item.ID === 13);
                // const currentBlockData = data.find(item => item.ID === 14);
                const currentBlockDataSLPP1 = webData.find(item => item.ID === 2); // SLPP-1
                const currentBlockDataSLPP2 = webData.find(item => item.ID === 8); // SLPP-2
                const previousBlockStatus = webData.find(item => item.ID === 3); // Frequency and Grid

                const cummUptoPreBlkSLPP1 = webData.find(item => item.ID === 4); // SLPP-1
                const cummUptoPreBlkSLPP2 = webData.find(item => item.ID === 10); // SLPP-2
                const cummUptoPreBlkSLPP = webData.find(item => item.ID === 15); // SLPP
                const acpFuelCostFrequency = rtData.find(item => item.ID === 6);
                const normalRate = webData.find(item => item.ID === 17);

                // Update DC Rev.No and SG Rev.No from currentBlockData (ID === 2)
                document.getElementById('block-no').textContent = formatNumber(currentBlockDataSLPP1.P1);
                document.getElementById('block-time').textContent = (currentBlockDataSLPP1.P2);

                // Populate the SLPP Phase-1 tbody
                const realTimeValueTbody = document.querySelector('.Real-Time-table tbody');
                const realTimeValueSLPPPhase2 = document.querySelector('.SLPP-Phase-2');
                const realTimeValueSLPP = document.querySelector('.SLPP');
                const currentBlockTable = document.querySelector('.Misnew-Current-Blocks-table');
                const cummUptoPreBlkTable = document.querySelector('.Misnew-Cumulatives-table tbody');
                const cummUptoPreBlkREACTIVEPOWERTable = document.querySelector('.REACTIVE-POWER');
                const acpFuelCostFrequencyTable = document.querySelector('.Acp-Fuel-Cost-Frequency-table tbody');
                const normalRateTable = document.querySelector('.Normal-Rate-table tbody');

                realTimeValueTbody.innerHTML = ''; // Clear existing rows
                realTimeValueSLPPPhase2.innerHTML = ''; // Clear existing rows
                realTimeValueSLPP.innerHTML = '';
                cummUptoPreBlkTable.innerHTML = '';
                cummUptoPreBlkREACTIVEPOWERTable.innerHTML = '';
                acpFuelCostFrequencyTable.innerHTML = '';
                normalRateTable.innerHTML = '';

                const realTimeValueRows = [
                    { label: 'GEN-1', mw: formatNumber(realTimeValue.P1), mvar: formatNumber(realTimeValue.P2) },
                    { label: 'GEN-2', mw: formatNumber(realTimeValue.P3), mvar: formatNumber(realTimeValue.P4) },
                    { label: 'TOTAL GEN', mw: formatNumber(realTimeValue.P5), mvar: formatNumber(realTimeValue.P6) },
                    { label: 'NET EXP', mw: formatNumber(realTimeValue.P7), mvar: formatNumber(realTimeValue.P8) },
                    { label: 'APC', mw: formatNumber(realTimeValue.P9), mvar: formatNumber(realTimeValue.P10) },
                    { label: '% APC', mw: `${formatNumber(realTimeValue.P11)}%`, mvar: '' },
                ];

                realTimeValueRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="real-time-value-label">${row.label}</td>
                <td class="real-time-value-value">${row.mw}</td>
                <td class="real-time-value-value">${row.mvar}</td>
            `;
                    realTimeValueTbody.appendChild(tr);
                });

                const realTimeValueSLPPPhase2Rows = [
                    { label: 'GEN-3', mw: formatNumber(realTimeValue.P12), mvar: formatNumber(realTimeValue.P13) },
                    { label: 'GEN-4', mw: formatNumber(realTimeValue.P14), mvar: formatNumber(realTimeValue.P15) },
                    { label: 'TOTAL GEN', mw: formatNumber(realTimeValue.P16), mvar: formatNumber(realTimeValue.P17) },
                    { label: 'NET EXP', mw: formatNumber(realTimeValue.P18), mvar: formatNumber(realTimeValue.P19) },
                    { label: 'APC', mw: formatNumber(realTimeValue.P20), mvar: formatNumber(realTimeValue.P21) },
                    { label: '% APC', mw: `${formatNumber(realTimeValue.P22)}%`, mvar: '' },
                ];

                realTimeValueSLPPPhase2Rows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="real-time-value-label">${row.label}</td>
                <td class="real-time-value-value">${row.mw}</td>
                <td class="real-time-value-value">${row.mvar}</td>
            `;
                    realTimeValueSLPPPhase2.appendChild(tr);
                });

                const realTimeSLPPRows = [
                    { label: 'TOTAL GEN', mw: formatNumber(realTimeValue.P23), mvar: formatNumber(realTimeValue.P24) },
                    { label: 'NET EXP', mw: formatNumber(realTimeValue.P25), mvar: formatNumber(realTimeValue.P26) },
                    { label: 'APC', mw: formatNumber(realTimeValue.P27), mvar: formatNumber(realTimeValue.P28) },
                    { label: '% APC', mw: `${formatNumber(realTimeValue.P29)}%`, mvar: '' },
                ];

                realTimeSLPPRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="real-time-value-label">${row.label}</td>
                <td class="real-time-value-value">${row.mw}</td>
                <td class="real-time-value-value">${row.mvar}</td>
            `;
                    realTimeValueSLPP.appendChild(tr);
                });

                const getColor = (value) => (value < 0 ? 'red' : '#00e800');

                currentBlockTable.innerHTML = `
            <caption class="Misnew-Current-Blocks-table-caption">Current Block</caption>
            <thead>
                <tr>
                    <td></td>
                    <td class="Current-Block-Heading">SLPP-1</td>
                    <td class="Current-Block-Heading">SLPP-2</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="Misnew-Current-block-label">Dec.Capacity (MW)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P4)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P4)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Sch.Generation (MW)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P5)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P5)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Backing Down (MW)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P6)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P6)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Exp./SG%</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P7)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P7)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Avg.Export (MW)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P9)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P9)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">DS (MW)</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP1.P10)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP1.P10)}</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP2.P10)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP2.P10)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">DS Rate (Rs)</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP1.P11)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP1.P11)}</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP2.P11)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP2.P11)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Total DS (Rs)</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP1.P14)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP1.P14)}</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP2.P14)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP2.P14)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Fuel Cost (Rs)</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP1.P15)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP1.P15)}</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP2.P15)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP2.P15)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Net Gain / Loss (Rs)</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP1.P16)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP1.P16)}</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP2.P16)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP2.P16)}</td>
                </tr>
            </tbody>
            <thead>
                <tr>
                    <td class="Current-Block-Subheading">Reactive Power</td>
                    <td class="Current-Block-Subheading">SLPP-1</td>
                    <td class="Current-Block-Subheading">SLPP-2</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="Misnew-Current-block-label">Avg. MVAr</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P17)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P17)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">MVAr (<97% of V)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P18)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P18)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">MVAr (>103% of V)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP1.P20)}</td>
                    <td class="Misnew-Current-block-value">${formatNumber(currentBlockDataSLPP2.P20)}</td>
                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Net Gain / Loss (Rs)</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP1.P22)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP1.P22)}</td>
                    <td class="Misnew-Current-block-value" style="color: ${getColor(currentBlockDataSLPP2.P22)}; font-weight: bold; text-align: center;">${formatNumber(currentBlockDataSLPP2.P22)}</td>
                </tr>
            </tbody>
            <thead>
                <tr>
                    <th colspan="3" class="Current-Block-Frequency-Heading">
                        Frequency (Hz) / Grid Voltage (%)
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="Misnew-Current-block-label">Inst. / Avg. Freq. (Hz)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(previousBlockStatus.P54)}</td>

                </tr>
                <tr>
                    <td class="Misnew-Current-block-label">Inst. / Avg. Grid V (%)</td>
                    <td class="Misnew-Current-block-value">${formatNumber(previousBlockStatus.P56)}</td>
                </tr>
            </tbody>
        `;

                // Labels that require negative values to be highlighted in red
                const criticalLabels = ['DS (MW)', 'Total DS (Rs)', 'Fuel Cost (Rs)', 'Net Gain / Loss (Rs)'];

                // Function to style negative values in red
                const getStyledValue = (value) => {
                    return `<td style="color: ${value < 0 ? 'red' : 'white'}; font-weight: bold; text-align: center;">${formatNumber(value)}</td>`;
                };

                const cummUptoPreBlkRows = [
                    { label: 'Gen-1/3 (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P2), value2: formatNumber(cummUptoPreBlkSLPP2.P2), value3: '' },
                    { label: 'Gen-2/4 (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P3), value2: formatNumber(cummUptoPreBlkSLPP2.P3), value3: '' },
                    { label: 'Station Gen (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P1), value2: formatNumber(cummUptoPreBlkSLPP2.P1), value3: formatNumber(cummUptoPreBlkSLPP.P1) },
                    { label: 'PLF (%)', value1: formatNumber(cummUptoPreBlkSLPP1.P22), value2: formatNumber(cummUptoPreBlkSLPP2.P22), value3: formatNumber(cummUptoPreBlkSLPP.P2) },
                    { label: 'APC (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P23), value2: formatNumber(cummUptoPreBlkSLPP2.P23), value3: formatNumber(cummUptoPreBlkSLPP.P3) },
                    { label: 'APC (%)', value1: formatNumber(cummUptoPreBlkSLPP1.P24), value2: formatNumber(cummUptoPreBlkSLPP2.P24), value3: formatNumber(cummUptoPreBlkSLPP.P4) },
                    { label: 'DC (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P4), value2: formatNumber(cummUptoPreBlkSLPP2.P4), value3: formatNumber(cummUptoPreBlkSLPP.P5) },
                    { label: 'SG - SLDC (Mwh)', value1: formatNumber(cummUptoPreBlkSLPP1.P25), value2: formatNumber(cummUptoPreBlkSLPP2.P25), value3: formatNumber(cummUptoPreBlkSLPP.P18) },
                    { label: 'SG - IEX (Mwh)', value1: formatNumber(cummUptoPreBlkSLPP1.P26), value2: formatNumber(cummUptoPreBlkSLPP2.P26), value3: formatNumber(cummUptoPreBlkSLPP.P19) },
                    { label: 'SG - Total (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P5), value2: formatNumber(cummUptoPreBlkSLPP2.P5), value3: formatNumber(cummUptoPreBlkSLPP.P6) },
                    { label: 'Backing Down (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P6), value2: formatNumber(cummUptoPreBlkSLPP2.P6), value3: formatNumber(cummUptoPreBlkSLPP.P7) },
                    { label: 'Net Export (MWh)', value1: formatNumber(cummUptoPreBlkSLPP1.P9), value2: formatNumber(cummUptoPreBlkSLPP2.P9), value3: formatNumber(cummUptoPreBlkSLPP.P8) },
                    { label: 'Exp./SG%', value1: formatNumber(cummUptoPreBlkSLPP1.P7), value2: formatNumber(cummUptoPreBlkSLPP2.P7), value3: formatNumber(cummUptoPreBlkSLPP.P9) },
                    { label: 'DS (MW)', value1: formatNumber(cummUptoPreBlkSLPP1.P10), value2: formatNumber(cummUptoPreBlkSLPP2.P10), value3: formatNumber(cummUptoPreBlkSLPP.P10) },
                    { label: 'Total DS (Rs)', value1: formatNumber(cummUptoPreBlkSLPP1.P13), value2: formatNumber(cummUptoPreBlkSLPP2.P13), value3: formatNumber(cummUptoPreBlkSLPP.P11) },
                    { label: 'Fuel Cost (Rs)', value1: formatNumber(cummUptoPreBlkSLPP1.P14), value2: formatNumber(cummUptoPreBlkSLPP2.P14), value3: formatNumber(cummUptoPreBlkSLPP.P12) },
                    { label: 'Net Gain / Loss (Rs)', value1: formatNumber(cummUptoPreBlkSLPP1.P15), value2: formatNumber(cummUptoPreBlkSLPP2.P15), value3: formatNumber(cummUptoPreBlkSLPP.P13) },
                ];

                cummUptoPreBlkRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="Misnew-Cumm-Upto-PreBlk-row-label">${row.label}</td>
                ${criticalLabels.includes(row.label) ? getStyledValue(row.value1) : `<td class="Misnew-Cumm-Upto-PreBlk-row-value">${row.value1}</td>`}
                ${criticalLabels.includes(row.label) ? getStyledValue(row.value2) : `<td class="Misnew-Cumm-Upto-PreBlk-row-value">${row.value2}</td>`}
                ${criticalLabels.includes(row.label) ? getStyledValue(row.value3) : `<td class="Misnew-Cumm-Upto-PreBlk-row-value">${row.value3}</td>`}
            `;
                    cummUptoPreBlkTable.appendChild(tr);
                });

                // Reactive Power Section
                const cummUptoPreBlkREACTIVEPOWERRows = [
                    { label: 'MVAr (<97% of V)', value1: formatNumber(cummUptoPreBlkSLPP1.P17), value2: formatNumber(cummUptoPreBlkSLPP2.P17), value3: formatNumber(cummUptoPreBlkSLPP.P14) },
                    { label: 'Gain / Loss (Rs)', value1: formatNumber(cummUptoPreBlkSLPP1.P18), value2: formatNumber(cummUptoPreBlkSLPP2.P18), value3: formatNumber(cummUptoPreBlkSLPP.P15) },
                    { label: 'MVAr (>103% of V)', value1: formatNumber(cummUptoPreBlkSLPP1.P19), value2: formatNumber(cummUptoPreBlkSLPP2.P19), value3: formatNumber(cummUptoPreBlkSLPP.P16) },
                    { label: 'Gain / Loss (Rs)', value1: formatNumber(cummUptoPreBlkSLPP1.P20), value2: formatNumber(cummUptoPreBlkSLPP2.P20), value3: formatNumber(cummUptoPreBlkSLPP.P17) },
                ];

                cummUptoPreBlkREACTIVEPOWERRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="Misnew-Cumm-Upto-PreBlk-row-label">${row.label}</td>
                <td class="Misnew-Cumm-Upto-PreBlk-row-value">${row.value1}</td>
                <td class="Misnew-Cumm-Upto-PreBlk-row-value">${row.value2}</td>
                <td class="Misnew-Cumm-Upto-PreBlk-row-value">${row.value3}</td>
            `;
                    cummUptoPreBlkREACTIVEPOWERTable.appendChild(tr);
                });

                const acpFuelCostFrequencyRows = [
                    { label: 'KJ', expMW: formatNumber(acpFuelCostFrequency.P1), impMW: formatNumber(acpFuelCostFrequency.P2), mvar: formatNumber(acpFuelCostFrequency.P3), volt: formatNumber(acpFuelCostFrequency.P4), amp: formatNumber(acpFuelCostFrequency.P5), pf: formatNumber(acpFuelCostFrequency.P6) },
                    { label: 'GV-4', expMW: formatNumber(acpFuelCostFrequency.P7), impMW: formatNumber(acpFuelCostFrequency.P8), mvar: formatNumber(acpFuelCostFrequency.P9), volt: formatNumber(acpFuelCostFrequency.P10), amp: formatNumber(acpFuelCostFrequency.P11), pf: formatNumber(acpFuelCostFrequency.P12) },
                    { label: 'ZL-1', expMW: formatNumber(acpFuelCostFrequency.P13), impMW: formatNumber(acpFuelCostFrequency.P14), mvar: formatNumber(acpFuelCostFrequency.P15), volt: formatNumber(acpFuelCostFrequency.P16), amp: formatNumber(acpFuelCostFrequency.P17), pf: formatNumber(acpFuelCostFrequency.P18) },
                    { label: 'ZL-2', expMW: formatNumber(acpFuelCostFrequency.P19), impMW: formatNumber(acpFuelCostFrequency.P20), mvar: formatNumber(acpFuelCostFrequency.P21), volt: formatNumber(acpFuelCostFrequency.P22), amp: formatNumber(acpFuelCostFrequency.P23), pf: formatNumber(acpFuelCostFrequency.P24) },
                    { label: 'AD -1', expMW: formatNumber(acpFuelCostFrequency.P25), impMW: formatNumber(acpFuelCostFrequency.P26), mvar: formatNumber(acpFuelCostFrequency.P27), volt: formatNumber(acpFuelCostFrequency.P28), amp: formatNumber(acpFuelCostFrequency.P29), pf: formatNumber(acpFuelCostFrequency.P30) },
                    { label: 'AD -2', expMW: formatNumber(acpFuelCostFrequency.P31), impMW: formatNumber(acpFuelCostFrequency.P32), mvar: formatNumber(acpFuelCostFrequency.P33), volt: formatNumber(acpFuelCostFrequency.P34), amp: formatNumber(acpFuelCostFrequency.P35), pf: formatNumber(acpFuelCostFrequency.P36) },
                    { label: 'TOTAL', expMW: formatNumber(acpFuelCostFrequency.P37), impMW: formatNumber(acpFuelCostFrequency.P38), mvar: formatNumber(acpFuelCostFrequency.P39), volt: '', amp: '', pf: '' },
                    { label: 'I/C-A', expMW: formatNumber(acpFuelCostFrequency.P40), impMW: formatNumber(acpFuelCostFrequency.P41), mvar: formatNumber(acpFuelCostFrequency.P42), volt: formatNumber(acpFuelCostFrequency.P43), amp: formatNumber(acpFuelCostFrequency.P44), pf: formatNumber(acpFuelCostFrequency.P45) },
                    { label: 'I/C-B', expMW: formatNumber(acpFuelCostFrequency.P46), impMW: formatNumber(acpFuelCostFrequency.P47), mvar: formatNumber(acpFuelCostFrequency.P48), volt: formatNumber(acpFuelCostFrequency.P49), amp: formatNumber(acpFuelCostFrequency.P50), pf: formatNumber(acpFuelCostFrequency.P51) },
                ];

                acpFuelCostFrequencyRows.forEach(row => {
                    const tr = document.createElement('tr');
                    // Check if the row label is "TOTAL"
                    const isTotalRow = row.label === 'TOTAL';
                    tr.innerHTML = `
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-label" style="color: #00eaea; font-weight: bold; ${isTotalRow ? 'border-top: 2px solid white; border-bottom: 2px solid white; border-left: 2px solid white; background-color: #333' : ''}">
                    ${row.label}
                </td>
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-value" style="color: ${isTotalRow ? '#00e800' : 'white'}; font-weight: bold; text-align: center; ${isTotalRow ? 'border: 2px solid white; border-left: none; border-right: none; background-color: #333' : ''}">
                    ${row.expMW}
                </td>
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-value" style="color: ${isTotalRow ? '#00e800' : 'white'}; font-weight: bold; text-align: center; ${isTotalRow ? 'border: 2px solid white; border-left: none; border-right: none; background-color: #333' : ''}">
                    ${row.impMW}
                </td>
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-value" style="color: ${isTotalRow ? '#00e800' : 'white'}; font-weight: bold; text-align: center; ${isTotalRow ? 'border: 2px solid white; border-left: none; background-color: #333' : ''}">
                    ${row.mvar}
                </td>
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-value" style="color: white; font-weight: bold; text-align: center;">
                    ${row.volt}
                </td>
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-value" style="color: white; font-weight: bold; text-align: center;">
                    ${row.amp}
                </td>
                <td class="Misnew-ACP-Fuel-Cost-Frequency-row-value" style="color: white; font-weight: bold; text-align: center;">
                    ${row.pf}
                </td>
            `;
                    acpFuelCostFrequencyTable.appendChild(tr);
                });

                const normalRateRows = [
                    { label: 'ACP (Rs./kWh)', value: formatNumber(normalRate.P2) },
                    { label: 'FuelCost Ph –1 (Rs./KWh)', value: formatNumber(normalRate.P3) },
                    { label: 'FuelCost Ph –2 (Rs./KWh)', value: formatNumber(normalRate.P4) },
                    { label: 'Avg.Freq.up to prev.Block', value: formatNumber(normalRate.P5) }
                ];

                normalRateRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="Misnew-Normal-Rate-row-label">${row.label}</td>
                <td class="Misnew-Normal-Rate-row-value">${row.value}</td>
            `;
                    normalRateTable.appendChild(tr);
                });

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        window.onload = function () {
            fetchData();
            setInterval(fetchData, 2000);
        };

    </script>
</body>

</html>