<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase-2</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="phase1.html">Phase-1</a></li>
                <li><a href="phase2.html">Phase-2</a></li>
                <li><a href="mis.html">MIS</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="header-container">
            <h2 class="table-title">GIPCL-SLPP Phase-2 DSM Monitoring</h2>
            <span class="date-time">
                Date: <span id="current-date" style="padding: 0 15px;"></span>
                Time: <span id="current-time" style="padding: 0 15px;"></span>
                DC Rev.No:<span id="dc-rev" style="padding: 0 15px;"></span>
                SG Rev.No: <span id="sg-rev" style="padding: 0 15px;"></span>
            </span>
        </div>
        <div class="tables-container">
            <table class="Previous-Block-table">
                <caption class="Previous-Block-caption">
                    Previous Block
                </caption>
                <tbody class="Previous-Block-tbody">

                </tbody>
            </table>

            <table class="Current-Block-table">
                <caption class="Current-Block-caption">Current Block</caption>
                <tbody class="Current-Block-table tbody">

                </tbody>
            </table>
            <div class="table-containerss">
                <table class="Previous-Block-Status-table">
                    <caption class="Previous-Block-Status-caption">Previous Block Status</caption>
                    <thead>
                        <tr class="header-row-1">
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                Blk.No<br>
                            </th>
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                Frequ<br>
                            </th>
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                SLDC.SG<br>
                            </th>
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                IEX.SG<br>
                            </th>
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                Tot.SG<br>
                            </th>
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                Net.Exp<br>
                            </th>
                            <th style="color: #00eaea; font-weight: bold; text-align: center; border-bottom: none;">
                                Dev<br>
                            </th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>

                <table class="Fuel-Cost-Frequency-table">
                    <caption class="Fuel-Cost-Frequency-caption">Fuel Cost / Frequency</caption>
                    <tbody>

                    </tbody>
                </table>

                <table class="Next-Block-table">
                    <caption class="Next-Block-caption">Next Block</caption>
                    <thead>
                        <tr>
                            <th class="Next-Block-table-label">Blk.No<br></th>
                            <th class="Next-Block-table-label">Blk.Time<br></th>
                            <th class="Next-Block-table-label">DC<br></th>
                            <th class="Next-Block-table-label">SLDC.SG<br></th>
                            <th class="Next-Block-table-label">IEX.SG<br></th>
                            <th class="Next-Block-table-label">Tot.SG<br></th>
                            <th class="Next-Block-table-label">USR<br></th>
                        </tr>
                        </tr>
                    </thead>
                    <tbody style="color: white;">

                    </tbody>
                </table>

                <table class="Normal-Rate-table">
                    <caption class="Normal-Rate-caption">Inst. Parameters</caption>
                    <thead>

                    </thead>
                    <tbody style="color: white;">

                    </tbody>
                </table>
            </div>

            <table class="Cumulative-table">
                <caption class="Cumulative-caption"> Cumm. Upto Pre Blk</caption>
                <tbody>

                </tbody>
            </table>
        </div>

        <div class="tables-containers">
            <table class="Real-Time-Generation-Data-table">
                <caption class="Real-Time-Generation-Data-caption">
                    Real Time Generation Data
                </caption>
                <thead>
                    <tr>
                        <th></th>
                        <th style="color: #00ffff; text-align: center;">MW</th>
                        <th style="color: #00ffff; text-align: center;">MVAR</th>
                        <th style="color: #00ffff; text-align: center;">VOLT(kV)</th>
                        <th style="color: #00ffff; text-align: center;">AMP (I)</th>
                        <th style="color: #00ffff; text-align: center;">PF</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>

            <table class="Real-Time-Exp-Imp-Data-table">
                <caption class="Real-Time-Exp-Imp-Data-caption">
                    Real Time Exp / Imp Data
                </caption>
                <thead>
                    <tr>
                        <th></th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center">EXP MW</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center">IMP MW</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center">MVAR</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center">VOLT(kV)</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center">AMP (I)</th>
                        <th style="color: #00eaea; font-weight: bold; text-align: center">PF</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const currentPage = window.location.pathname.split("/").pop(); // Get the current page name
            const navLinks = document.querySelectorAll("nav ul li a");

            navLinks.forEach(link => {
                // Remove the active class from all links
                link.classList.remove("active");

                // Add the active class to the current link
                if (link.getAttribute("href") === currentPage) {
                    link.classList.add("active");
                }
            });
        });

        const formatNumber = (value) => {
            if (value === null || value === undefined || isNaN(Number(value))) {
                return 'undefined';
            }
            const num = Number(value);
            // If the number is an integer, return it as a string
            if (Number.isInteger(num)) {
                return num.toString();
            }
            // For non-integer numbers, use toFixed(4) and remove trailing zeros and decimal point if necessary
            return parseFloat(num.toFixed(4)).toString();
        };

        function updateDateTime() {
            const now = new Date();
            // Format date as DD/MM/YYYY
            const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-GB', dateOptions);
            // Format time as HH:MM:SS
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const formattedTime = now.toLocaleTimeString('en-GB', timeOptions);
            // Update the HTML elements with the current date and time
            document.getElementById('current-date').textContent = formattedDate;
            document.getElementById('current-time').textContent = formattedTime;
        }

        // Call the function to set the initial date and time
        updateDateTime();
        // Optionally, update the time every second
        setInterval(updateDateTime, 1000);

        async function fetchData() {
            try {
                // Fetch data from both endpoints
                const [webDataResponse, rtDataResponse] = await Promise.all([
                    fetch('/EMS_Network/WebData'),
                    fetch('/EMS_Network/RTWebData')
                ]);

                if (!webDataResponse.ok || !rtDataResponse.ok) {
                    throw new Error('Network response was not ok');
                }

                const webData = await webDataResponse.json();
                const rtData = await rtDataResponse.json();

                console.log('WebData:', webData); // Log the fetched web data
                console.log('RTData:', rtData); // Log the fetched RT data


                // Filter the data for ID 1, ID 2, ID 3, and ID 4 (Cumm. Upto Pre Blk)
                const previousBlockData = webData.find(item => item.ID === 7);
                const currentBlockData = webData.find(item => item.ID === 8);
                const previousBlockStatus = webData.find(item => item.ID === 9);
                const cummUptoPreBlk = webData.find(item => item.ID === 10);
                const realTimeGenerationData = rtData.find(item => item.ID === 5);
                const realTimeExpImpData = rtData.find(item => item.ID === 6);

                const next8blocksData = webData.find(item => item.ID === 21);
                const newpreviousBlockStatus = webData.find(item => item.ID === 22);



                // Update DC Rev.No and SG Rev.No from currentBlockData (ID === 2)
                document.getElementById('dc-rev').textContent = formatNumber(currentBlockData.P23);
                document.getElementById('sg-rev').textContent = formatNumber(currentBlockData.P24);

                // Assuming the data is an object with properties that match the table rows
                const previousBlockTbody = document.querySelector('.Previous-Block-tbody');
                const currentBlockTbody = document.querySelector('.Current-Block-table tbody');
                const previousBlockStatusTbody = document.querySelector('.Previous-Block-Status-table tbody');
                const fuelCostFrequencyTbody = document.querySelector('.Fuel-Cost-Frequency-table tbody');
                const nextBlockTbody = document.querySelector('.Next-Block-table tbody');
                const normalRateTbody = document.querySelector('.Normal-Rate-table tbody');
                const cumulativeTbody = document.querySelector('.Cumulative-table tbody');
                const realTimeGenerationTbody = document.querySelector('.Real-Time-Generation-Data-table tbody');
                const realTimeExpImpTbody = document.querySelector('.Real-Time-Exp-Imp-Data-table tbody');

                // Clear existing rows
                previousBlockTbody.innerHTML = '';
                currentBlockTbody.innerHTML = '';
                previousBlockStatusTbody.innerHTML = '';
                fuelCostFrequencyTbody.innerHTML = '';
                nextBlockTbody.innerHTML = '';
                normalRateTbody.innerHTML = '';
                cumulativeTbody.innerHTML = '';
                realTimeGenerationTbody.innerHTML = '';
                realTimeExpImpTbody.innerHTML = '';

                // Populate the Previous Block table with ID 7 data
                const previousBlockRows = [
                    { label: 'Block No', value: previousBlockData.P1 },
                    { label: 'Block Time', value: previousBlockData.P2 },
                    { label: 'Dec.Capacity (MW)', value: previousBlockData.P3 },
                    { label: 'Sch.Generation (MW)', value: previousBlockData.P4 },
                    { label: 'Backing Down (MW)', value: previousBlockData.P5 },
                    { label: 'Exp./SG%', value: previousBlockData.P6 },
                    { label: 'Avg.Frequency (Hz)', value: previousBlockData.P7 },
                    { label: 'Avg.Export (MW)', value: previousBlockData.P8 },
                    { label: 'DS (MW)', value: previousBlockData.P9 },
                    { label: 'DS Rate (Rs)', value: previousBlockData.P10 },
                    { label: 'DS (Rs)', value: previousBlockData.P11 },
                    { label: 'DS beyond ± 10% (Rs)', value: previousBlockData.P12 },
                    { label: 'Total DS (Rs)', value: previousBlockData.P13 },
                    { label: 'Fuel Cost (Rs)', value: previousBlockData.P14 },
                    { label: 'Net Gain /  Loss (Rs)', value: previousBlockData.P15 },
                    { label: 'Avg. MVARh', value: previousBlockData.P16 },
                    { label: 'MVARh (<97% of V)', value: previousBlockData.P17 },
                    { label: 'Gain / Loss (Rs)', value: previousBlockData.P18 },
                    { label: 'MVARh (>103% of V)', value: previousBlockData.P19 },
                    { label: 'Gain / Loss (Rs)', value: previousBlockData.P20 },
                    { label: 'Net Gain / Loss (Rs)', value: previousBlockData.P21 },
                ];

                const integerLabels = [
                    'DS (Rs)',
                    'DS beyond ± 10% (Rs)',
                    'Total DS (Rs)',
                    'Fuel Cost (Rs)',
                    'Net Gain /  Loss (Rs)',
                    'Gain / Loss (Rs)',
                    'Net Gain / Loss (Rs)'
                ];

                previousBlockRows.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    let value;
                    if (row.label === 'Block No' || row.label === 'Block Time') {
                        value = row.value;
                    } else {
                        // Assuming row.value is a number; parseFloat ensures it's treated as such
                        const numValue = parseFloat(row.value);
                        if (isNaN(numValue)) {
                            value = row.value;
                        } else {
                            const fixedDigits = integerLabels.includes(row.label) ? 0 : 2;
                            value = numValue.toFixed(fixedDigits);
                        }
                    }
                    // Define the labels that should have red text when their value is negative
                    const labelsWithRedText = [
                        'DS (MW)', 'DS Rate (Rs)', 'DS (Rs)',
                        'DS beyond ± 10% (Rs)', 'Total DS (Rs)',
                        'Fuel Cost (Rs)', 'Net Gain / Loss (Rs)'
                    ];

                    tr.innerHTML = `
        <td class="previousBlock-label">${row.label}</td>
        <td class="previousBlock-value" style="color: ${parseFloat(row.value) < 0 && labelsWithRedText.includes(row.label) ? 'red' : 'white'};">
            ${value}
        </td>
    `;

                    previousBlockTbody.appendChild(tr);

                    // Check if the current row is "Net Gain / Loss (Rs)" to insert the Reactive Power header
                    if (row.label === 'Net Gain /  Loss (Rs)') {
                        const reactivePowerRow = document.createElement('tr');
                        reactivePowerRow.innerHTML = `
            <th colspan="3" class="reactive-power-header">Reactive Power</th>
        `;
                        previousBlockTbody.appendChild(reactivePowerRow);
                    }
                });

                // Populate the Current Block table with ID 8 data
                const currentBlockRows = [
                    { label: 'Block No', value: currentBlockData.P1 },
                    { label: 'Block Time', value: currentBlockData.P2 },
                    { label: 'Time Left', value: currentBlockData.P3 },
                    { label: 'Dec.Capacity (MW)', value: currentBlockData.P4 },
                    { label: 'Sch.Generation (MW)', value: currentBlockData.P5 },
                    { label: 'Backing Down (MW)', value: currentBlockData.P6 },
                    { label: 'Exp./SG%', value: currentBlockData.P7 },
                    { label: 'Avg.Frequency (Hz)', value: currentBlockData.P8 },
                    { label: 'Avg.Export (MW)', value: currentBlockData.P9 },
                    { label: 'DS (MW)', value: currentBlockData.P10 },
                    { label: 'DS Rate (Rs)', value: currentBlockData.P11 },
                    { label: 'DS (Rs)', value: currentBlockData.P12 },
                    { label: 'DS beyond ± 10% (Rs)', value: currentBlockData.P13 },
                    { label: 'Total DS (Rs)', value: currentBlockData.P14 },
                    { label: 'Fuel Cost (Rs)', value: currentBlockData.P15 },
                    { label: 'Net Gain /  Loss (Rs)', value: currentBlockData.P16 },
                    { label: 'Avg. MVARh', value: currentBlockData.P17 },
                    { label: 'MVARh (<97% of V)', value: currentBlockData.P18 },
                    { label: 'Gain / Loss (Rs)', value: currentBlockData.P19 },
                    { label: 'MVARh (>103% of V)', value: currentBlockData.P20 },
                    { label: 'Gain / Loss (Rs)', value: currentBlockData.P21 },
                    { label: 'Net Gain / Loss (Rs)', value: currentBlockData.P22 },
                ];

                const integerLabelss = [
                    'DS (Rs)',
                    'DS beyond ± 10% (Rs)',
                    'Total DS (Rs)',
                    'Fuel Cost (Rs)',
                    'Net Gain /  Loss (Rs)',
                    'Gain / Loss (Rs)',
                    'Net Gain / Loss (Rs)'
                ];

                currentBlockRows.forEach(row => {
                    const tr = document.createElement('tr');
                    let value;
                    if (row.label === 'Block No' || row.label === 'Block Time' || row.label === 'Time Left') {
                        value = row.value;
                    } else {
                        // Assuming row.value is a number; parseFloat ensures it's treated as such
                        const numValue = parseFloat(row.value);
                        if (isNaN(numValue)) {
                            value = row.value;
                        } else {
                            const fixedDigits = integerLabelss.includes(row.label) ? 0 : 2;
                            value = numValue.toFixed(fixedDigits);
                        }
                    }

                    // Labels that should have red text when the value is negative
                    const labelsWithRedText = [
                        'DS (MW)', 'DS Rate (Rs)', 'DS (Rs)',
                        'DS beyond ± 10% (Rs)', 'Total DS (Rs)',
                        'Fuel Cost (Rs)', 'Net Gain / Loss (Rs)'
                    ];

                    tr.innerHTML = `
        <td class="currentBlock-label">${row.label}</td>
        <td class="currentBlock-value" style="color: ${parseFloat(row.value) < 0 && labelsWithRedText.includes(row.label) ? 'red' : '#00e800'};">
            ${value}
        </td>
    `;

                    currentBlockTbody.appendChild(tr);

                    // Check if the current row is "Net Gain / Loss (Rs)" to insert the Reactive Power header
                    if (row.label === 'Net Gain /  Loss (Rs)') {
                        const reactivePowerRow = document.createElement('tr');
                        reactivePowerRow.innerHTML = `
            <th colspan="3" class="reactive-power-header">Reactive Power</th>
        `;
                        currentBlockTbody.appendChild(reactivePowerRow);
                    }
                });

                // Populate the Previous Block Status table with ID 9 data
                const previousBlockStatusRows = [
                    {
                        blockNo: newpreviousBlockStatus.P1,
                        frequency: newpreviousBlockStatus.P2,
                        sldcSG: newpreviousBlockStatus.P3,    // SLDC.SG column
                        iexSG: newpreviousBlockStatus.P4,     // IEX SG column (adjust property number as needed)
                        totSG: newpreviousBlockStatus.P5,     // Tot.SG column (adjust property number as needed)
                        netExport: newpreviousBlockStatus.P6,
                        devMW: newpreviousBlockStatus.P7
                    },
                    {
                        blockNo: newpreviousBlockStatus.P8,
                        frequency: newpreviousBlockStatus.P9,
                        sldcSG: newpreviousBlockStatus.P10,
                        iexSG: newpreviousBlockStatus.P11,     // Adjust property numbers
                        totSG: newpreviousBlockStatus.P12,
                        netExport: newpreviousBlockStatus.P13,
                        devMW: newpreviousBlockStatus.P14
                    },
                    {
                        blockNo: newpreviousBlockStatus.P15,
                        frequency: newpreviousBlockStatus.P16,
                        sldcSG: newpreviousBlockStatus.P17,
                        iexSG: newpreviousBlockStatus.P18,
                        totSG: newpreviousBlockStatus.P19,
                        netExport: newpreviousBlockStatus.P20,
                        devMW: newpreviousBlockStatus.P21
                    },
                    {
                        blockNo: newpreviousBlockStatus.P22,
                        frequency: newpreviousBlockStatus.P23,
                        sldcSG: newpreviousBlockStatus.P24,
                        iexSG: newpreviousBlockStatus.P25,
                        totSG: newpreviousBlockStatus.P26,
                        netExport: newpreviousBlockStatus.P27,
                        devMW: newpreviousBlockStatus.P28
                    },
                    {
                        blockNo: 'Average',
                        frequency: newpreviousBlockStatus.P29,
                        sldcSG: newpreviousBlockStatus.P30,
                        iexSG: newpreviousBlockStatus.P31,
                        totSG: newpreviousBlockStatus.P32,
                        netExport: newpreviousBlockStatus.P33,
                        devMW: newpreviousBlockStatus.P34
                    },
                ];

                const formatValue = (value) => {
                    const numValue = parseFloat(value);
                    return isNaN(numValue) ? value : numValue.toFixed(2);
                };

                previousBlockStatusRows.forEach(row => {
                    const tr = document.createElement('tr');

                    // Function to determine text color class
                    const getColorClass = (value, column) => {
                        const numValue = parseFloat(value);
                        if (row.blockNo === 'Average') {
                            return isNaN(numValue) ? 'text-green' : (numValue < 0 ? 'text-red' : 'text-green');
                        }
                        // Apply red color only for Dev.MW when value is negative
                        if (column === 'devMW' && !isNaN(numValue) && numValue < 0) {
                            return 'text-red';
                        }
                        return 'text-white';
                    };

                    // Generate table row with class-based styling
                    tr.innerHTML = `
        <td class="previous-block-status-label ${row.blockNo === 'Average' ? 'average-row' : ''} ${row.blockNo === 'Average' ? 'text-green' : 'text-white'}">${row.blockNo}</td>
        <td class="table-cell ${row.blockNo === 'Average' ? 'average-row' : ''} ${getColorClass(row.frequency, 'frequency')}">${formatValue(row.frequency)}</td>
        <td class="table-cell ${row.blockNo === 'Average' ? 'average-row' : ''} ${getColorClass(row.sldcSG, 'sldcSG')}">${formatValue(row.sldcSG)}</td>
        <td class="table-cell ${row.blockNo === 'Average' ? 'average-row' : ''} ${getColorClass(row.iexSG, 'iexSG')}">${formatValue(row.iexSG)}</td>
        <td class="table-cell ${row.blockNo === 'Average' ? 'average-row' : ''} ${getColorClass(row.totSG, 'totSG')}">${formatValue(row.totSG)}</td>
        <td class="table-cell ${row.blockNo === 'Average' ? 'average-row' : ''} ${getColorClass(row.netExport, 'netExport')}">${formatValue(row.netExport)}</td>
        <td class="table-cell ${row.blockNo === 'Average' ? 'average-row' : ''} ${getColorClass(row.devMW, 'devMW')}">${formatValue(row.devMW)}</td>
    `;

                    previousBlockStatusTbody.appendChild(tr);
                });

                // Populate the Fuel Cost / Frequency table
                const fuelCostFrequencyRows = [
                    { label: 'Fuel Cost (Rs./kWh)', value: previousBlockStatus.P35 },
                    { label: 'ACP (RS./kWh)', value: previousBlockStatus.P36 },
                ];

                fuelCostFrequencyRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="fuelCost-label">${row.label}</td>
                <td class="fuelCost-value">${formatValue(row.value)}</td>
            `;
                    fuelCostFrequencyTbody.appendChild(tr);
                });

                if (next8blocksData) {
                    console.log('Full next8blocksData object:', next8blocksData);

                    // Pattern: Sequential groups of 6 properties per block
                    // Block 1: P1-P6, Block 2: P7-P12, Block 3: P13-P18, etc.
                    const nextBlockRows = [
                        {
                            blockNo: next8blocksData.P1,
                            blockTime: next8blocksData.P2,
                            dcMW: next8blocksData.P3,
                            sldcSG: next8blocksData.P49,
                            totalSG: next8blocksData.P4,
                            iexSG: next8blocksData.P5,          // IEX SG column
                            surplusPower: next8blocksData.P6    // SurplusPower column
                        },
                        {
                            blockNo: next8blocksData.P7,
                            blockTime: next8blocksData.P8,
                            dcMW: next8blocksData.P9,
                            sldcSG: next8blocksData.P50,
                            totalSG: next8blocksData.P10,
                            iexSG: next8blocksData.P11,
                            surplusPower: next8blocksData.P12
                        },
                        {
                            blockNo: next8blocksData.P13,
                            blockTime: next8blocksData.P14,
                            dcMW: next8blocksData.P15,
                            sldcSG: next8blocksData.P51,
                            totalSG: next8blocksData.P16,
                            iexSG: next8blocksData.P17,
                            surplusPower: next8blocksData.P18
                        },
                        {
                            blockNo: next8blocksData.P19,
                            blockTime: next8blocksData.P20,
                            dcMW: next8blocksData.P21,
                            sldcSG: next8blocksData.P52,
                            totalSG: next8blocksData.P22,
                            iexSG: next8blocksData.P23,
                            surplusPower: next8blocksData.P24
                        },
                        {
                            blockNo: next8blocksData.P25,
                            blockTime: next8blocksData.P26,
                            dcMW: next8blocksData.P27,
                            sldcSG: next8blocksData.P53,
                            totalSG: next8blocksData.P28,
                            iexSG: next8blocksData.P29,
                            surplusPower: next8blocksData.P30
                        },
                        {
                            blockNo: next8blocksData.P31,
                            blockTime: next8blocksData.P32,
                            dcMW: next8blocksData.P33,
                            sldcSG: next8blocksData.P54,
                            totalSG: next8blocksData.P34,
                            iexSG: next8blocksData.P35,
                            surplusPower: next8blocksData.P36
                        },
                        {
                            blockNo: next8blocksData.P37,
                            blockTime: next8blocksData.P38,
                            dcMW: next8blocksData.P39,
                            sldcSG: next8blocksData.P55,
                            totalSG: next8blocksData.P40,
                            iexSG: next8blocksData.P41,
                            surplusPower: next8blocksData.P42
                        },
                        {
                            blockNo: next8blocksData.P43,
                            blockTime: next8blocksData.P44,
                            dcMW: next8blocksData.P45,
                            sldcSG: next8blocksData.P56,
                            totalSG: next8blocksData.P46,
                            iexSG: next8blocksData.P47,
                            surplusPower: next8blocksData.P48
                        },
                    ];

                    nextBlockRows.forEach((row, index) => {
                        console.log(`Row ${index + 1}:`, row);
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
            <td class="next-block-label">${row.blockNo}</td>
            <td class="next-block-label">${row.blockTime}</td>
            <td class="next-block-label">${formatValue(row.dcMW)}</td>
            <td class="next-block-label">${formatValue(row.sldcSG)}</td>
            <td class="next-block-label">${formatValue(row.iexSG)}</td>
            <td class="next-block-label">${formatValue(row.totalSG)}</td>
            <td class="next-block-label">${formatValue(row.surplusPower)}</td>
        `;
                        nextBlockTbody.appendChild(tr);
                    });
                } else {
                    console.warn('Next 8 blocks data not found (ID 19 in WebData)');
                }

                // Populate the Normal Rate table
                const normalRateRows = [
                    { label: 'Net Exp (MW)', value: previousBlockStatus.P53 },
                    { label: ' Frequency (Hz)', value: previousBlockStatus.P54 },
                    { label: 'Net Exp (MVARh)', value: previousBlockStatus.P55 },
                    { label: 'Grid Voltage (%)', value: previousBlockStatus.P56 },
                ];

                normalRateRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td class="normal-rate-label">${row.label}</td>
                <td class="normal-rate-value">${formatValue(row.value)}</td>
            `;
                    normalRateTbody.appendChild(tr);
                });

                // Populate the Cumulative table with ID 10 data
                const cumulativeRows = [
                    { label: 'Station Gen (MWh)', value: cummUptoPreBlk.P1 },
                    { label: 'Gen-1 (MWh)', value: cummUptoPreBlk.P2 },
                    { label: 'Gen-2 (MWh)', value: cummUptoPreBlk.P3 },
                    { label: 'DC (MWh)', value: cummUptoPreBlk.P4 },
                    { label: 'SG - SLDC (MWh)', value: cummUptoPreBlk.P25 },
                    { label: 'SG - IEX (MWh)', value: cummUptoPreBlk.P26 },
                    { label: 'SG - Total (MWh)', value: cummUptoPreBlk.P5 },
                    { label: 'Backing Down (MWh)', value: cummUptoPreBlk.P6 },
                    { label: 'Exp./SG%', value: cummUptoPreBlk.P7 },
                    { label: 'Avg. Frequency (Hz)', value: cummUptoPreBlk.P8 },
                    { label: 'Net Export (MWh)', value: cummUptoPreBlk.P9 },
                    { label: 'DS (MW)', value: cummUptoPreBlk.P10 },
                    { label: 'DS (Rs)', value: cummUptoPreBlk.P11 },
                    { label: 'DS beyond ± 10% (Rs)', value: cummUptoPreBlk.P12 },
                    { label: 'Total DS (Rs)', value: cummUptoPreBlk.P13 },
                    { label: 'Fuel Cost (Rs)', value: cummUptoPreBlk.P14 },
                    { label: 'Net Gain / Loss (Rs)', value: cummUptoPreBlk.P15 },
                    { label: 'Net Exp (MVARh)', value: cummUptoPreBlk.P16 },
                    { label: 'MVARh (<97% of V)', value: cummUptoPreBlk.P17 },
                    { label: 'Gain / Loss (Rs)', value: cummUptoPreBlk.P18 },
                    { label: 'MVARh (>103% of V)', value: cummUptoPreBlk.P19 },
                    { label: 'Gain / Loss (Rs)', value: cummUptoPreBlk.P20 },
                    { label: 'Net Gain / Loss (Rs) ', value: cummUptoPreBlk.P21 }
                ];

                // Labels that should show rounded values (no decimals)
                const labelsToRound = [
                    'Station Gen (MWh)',
                    'Gen-1 (MWh)',
                    'Gen-2 (MWh)',
                    'DC (MWh)',
                    'SG - SLDC (MWh)',
                    'SG - IEX (MWh)',
                    'SG - Total (MWh)',
                    'Backing Down (MWh)',
                    'Net Export (MWh)'
                ];

                const integerRsLabels = [
                    'DS Rate (Rs)',
                    'DS (Rs)',
                    'DS beyond ± 10% (Rs)',
                    'Total DS (Rs)',
                    'Fuel Cost (Rs)',
                    'Net Gain / Loss (Rs)',
                    'Gain / Loss (Rs)',
                    'Net Gain / Loss (Rs) '
                ];

                // Labels that require red color when values are negative
                const labelsWithRedColor = [
                    'DS (MW)',
                    'DS (Rs)',
                    'DS beyond ± 10% (Rs)',
                    'Total DS (Rs)',
                    'Fuel Cost (Rs)',
                    'Net Gain / Loss (Rs)'
                ];

                // Function to format value based on label
                const formatValueByLabel = (value, label) => {
                    // Handle null, undefined, or empty values
                    if (value === null || value === undefined || value === '') {
                        return '-';
                    }

                    // Convert to number if it's a string
                    const numValue = typeof value === 'string' ? parseFloat(value) : value;

                    // Check if it's a valid number
                    if (isNaN(numValue)) {
                        return value;
                    }

                    if (labelsToRound.includes(label) || integerRsLabels.includes(label)) {
                        // Round to nearest integer without commas
                        return Math.round(numValue).toString();
                    } else {
                        // Show with 2 decimal places without commas
                        return numValue.toFixed(2);
                    }
                };

                // Function to determine text color based on label
                const getColor = (value, label) => {
                    const numValue = typeof value === 'string' ? parseFloat(value) : value;
                    if (typeof numValue === 'number' && numValue < 0 && labelsWithRedColor.includes(label)) {
                        return 'red';
                    }
                    return 'white';
                };

                cumulativeRows.forEach(row => {
                    const tr = document.createElement('tr');

                    tr.innerHTML = `
        <td class="cumulative-label">${row.label}</td>
        <td class="cumulative-value" style="color: ${getColor(row.value, row.label)};">
            ${formatValueByLabel(row.value, row.label)}
        </td>
    `;

                    cumulativeTbody.appendChild(tr);

                    // Add "Reactive Power" row if label is "Net Gain / Loss (Rs)"
                    if (row.label === 'Net Gain / Loss (Rs)') {
                        const reactivePowerRow = document.createElement('tr');
                        reactivePowerRow.innerHTML = `
            <th colspan="3" class="reactive-power-header">Reactive Power</th>
        `;
                        cumulativeTbody.appendChild(reactivePowerRow);
                    }
                });


                // Populate the Real Time Generation table
                const realTimeRows = [
                    { label: 'GEN-1', mw: realTimeGenerationData.P1, mvar: realTimeGenerationData.P2, volt: realTimeGenerationData.P3, amp: realTimeGenerationData.P4, pf: realTimeGenerationData.P5 },
                    { label: 'GEN-2', mw: realTimeGenerationData.P6, mvar: realTimeGenerationData.P7, volt: realTimeGenerationData.P8, amp: realTimeGenerationData.P9, pf: realTimeGenerationData.P10 },
                    { label: 'GEN-3', mw: realTimeGenerationData.P11, mvar: realTimeGenerationData.P12, volt: realTimeGenerationData.P13, amp: realTimeGenerationData.P14, pf: realTimeGenerationData.P15 },
                    { label: 'GEN-4', mw: realTimeGenerationData.P16, mvar: realTimeGenerationData.P17, volt: realTimeGenerationData.P18, amp: realTimeGenerationData.P19, pf: realTimeGenerationData.P20 },
                    { label: 'TOTAL', mw: realTimeGenerationData.P21, mvar: realTimeGenerationData.P22, volt: '', amp: '', pf: '' },
                ];

                realTimeRows.forEach(row => {
                    const labelColor = (row.label === 'PH-1 Inst./Cumm. APC (MWh / %)' || row.label === 'PH-2 Inst./Cumm. APC (MWh / %)') ? '#de00de' : '#00eaea';
                    const tr = document.createElement('tr');

                    if (row.label === 'TOTAL') {
                        tr.innerHTML = `
                    <td class="Total-Row">${row.label}</td>
                    <td style="text-align: center" class="Total-Row">${formatValue(row.mw)}</td>
                    <td style="text-align: center" class="Total-Row">${formatValue(row.mvar)}</td>
                `;
                    } else {
                        tr.innerHTML = `
                    <td class="real-time-generation-data-label" style="color: ${labelColor}; font-weight: bold;">${row.label}</td>
                    <td style="text-align: center; color: white; font-weight: bold;">${formatValue(row.mw)}</td>
                    <td style="text-align: center; color: white; font-weight: bold;">${formatValue(row.mvar)}</td>
                    <td style="text-align: center; color: white; font-weight: bold;">${formatValue(row.volt)}</td>
                    <td style="text-align: center; color: white; font-weight: bold;">${Math.round(row.amp)}</td>
                    <td style="text-align: center; color: white; font-weight: bold;">${formatValue(row.pf)}</td>
                `;
                    }

                    realTimeGenerationTbody.appendChild(tr);

                    if (row.label === 'TOTAL') {
                        const emptyRow = document.createElement('tr');
                        emptyRow.innerHTML = `<td colspan="6" style="height: 5%;"></td>`;
                        realTimeGenerationTbody.appendChild(emptyRow);

                        const apcRow = document.createElement('tr');
                        apcRow.innerHTML = `
                    <th colspan="6" class="Real-Time-Generation-Data-APC">APC</th>
                `;
                        realTimeGenerationTbody.appendChild(apcRow);

                        const newHeaderRow = document.createElement('tr');
                        newHeaderRow.innerHTML = `
                    <th></th>
                    <th></th>
                    <th style="text-align: center" class="Real-Time-Generation-Data-Subheader">Inst (MW)</th>
                    <th style="text-align: center" class="Real-Time-Generation-Data-Subheader">Inst (%)</th>
                    <th style="text-align: center" class="Real-Time-Generation-Data-Subheader">Cum (MWh)</th>
                    <th style="text-align: center" class="Real-Time-Generation-Data-Subheader">Cum (%)</th>
                `;
                        realTimeGenerationTbody.appendChild(newHeaderRow);

                        const ph1Row = document.createElement('tr');
                        ph1Row.innerHTML = `
                    <td class="Real-Time-Generation-Data-row-label">PH-1 Inst./Cumm. APC (MWh / %)</td>
                    <td></td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${formatValue(realTimeGenerationData.P23)}</td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${formatValue(realTimeGenerationData.P24)}</td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${Math.round(realTimeGenerationData.P25)}</td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${formatValue(realTimeGenerationData.P26)}</td>
                `;
                        realTimeGenerationTbody.appendChild(ph1Row);

                        const ph2Row = document.createElement('tr');
                        ph2Row.innerHTML = `
                    <td class="Real-Time-Generation-Data-row-label">PH-2 Inst./Cumm. APC (MWh / %)</td>
                    <td></td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${formatValue(realTimeGenerationData.P27)}</td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${formatValue(realTimeGenerationData.P28)}</td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${Math.round(realTimeGenerationData.P29)}</td>
                    <td style="text-align: center" class="Real-Time-Generation-Data-row-value">${formatValue(realTimeGenerationData.P30)}</td>
                `;
                        realTimeGenerationTbody.appendChild(ph2Row);
                    }
                });

                // Populate the Real Time Exp/Imp table
                const expImpRows = [
                    { label: 'KJ', expMW: realTimeExpImpData.P1, impMVV: realTimeExpImpData.P2, mvar: realTimeExpImpData.P3, volt: realTimeExpImpData.P4, amp: realTimeExpImpData.P5, pf: realTimeExpImpData.P6 },
                    { label: 'GV-4', expMW: realTimeExpImpData.P7, impMVV: realTimeExpImpData.P8, mvar: realTimeExpImpData.P9, volt: realTimeExpImpData.P10, amp: realTimeExpImpData.P11, pf: realTimeExpImpData.P12 },
                    { label: 'ZL-1', expMW: realTimeExpImpData.P13, impMVV: realTimeExpImpData.P14, mvar: realTimeExpImpData.P15, volt: realTimeExpImpData.P16, amp: realTimeExpImpData.P17, pf: realTimeExpImpData.P18 },
                    { label: 'ZL-2', expMW: realTimeExpImpData.P19, impMVV: realTimeExpImpData.P20, mvar: realTimeExpImpData.P21, volt: realTimeExpImpData.P22, amp: realTimeExpImpData.P23, pf: realTimeExpImpData.P24 },
                    { label: 'AD -1', expMW: realTimeExpImpData.P25, impMVV: realTimeExpImpData.P26, mvar: realTimeExpImpData.P27, volt: realTimeExpImpData.P28, amp: realTimeExpImpData.P29, pf: realTimeExpImpData.P30 },
                    { label: 'AD -2', expMW: realTimeExpImpData.P31, impMVV: realTimeExpImpData.P32, mvar: realTimeExpImpData.P33, volt: realTimeExpImpData.P34, amp: realTimeExpImpData.P35, pf: realTimeExpImpData.P36 },
                    { label: 'I/C-A', expMW: realTimeExpImpData.P37, impMVV: realTimeExpImpData.P38, mvar: realTimeExpImpData.P39, volt: realTimeExpImpData.P40, amp: realTimeExpImpData.P41, pf: realTimeExpImpData.P42 },
                    { label: 'I/C-B', expMW: realTimeExpImpData.P43, impMVV: realTimeExpImpData.P44, mvar: realTimeExpImpData.P45, volt: realTimeExpImpData.P46, amp: realTimeExpImpData.P47, pf: realTimeExpImpData.P48 },
                ];

                expImpRows.forEach(row => {
                    const tr = document.createElement('tr');
                    const isTotalRow = row.label === 'TOTAL';

                    tr.innerHTML = `
                <td class="real-time-exp-imp-data-row-label" style="color: #00eaea; font-weight: bold; ${isTotalRow ? 'border-top: 2px solid white; border-bottom: 2px solid white; border-left: 2px solid white; background-color: #333' : ''}">
                    ${row.label}
                </td>
                <td class="real-time-exp-imp-data-row-value" style="color: ${isTotalRow ? '#00e800' : 'white'}; font-weight: bold; text-align: center; ${isTotalRow ? 'border: 2px solid white; border-left: none; border-right: none; background-color: #333' : ''}">
                    ${formatValue(row.expMW)}
                </td>
                <td class="real-time-exp-imp-data-row-value" style="color: ${isTotalRow ? '#00e800' : 'white'}; font-weight: bold; text-align: center; ${isTotalRow ? 'border: 2px solid white; border-left: none; border-right: none; background-color: #333' : ''}">
                    ${formatValue(row.impMVV)}
                </td>
                <td class="real-time-exp-imp-data-row-value" style="color: ${isTotalRow ? '#00e800' : 'white'}; font-weight: bold; text-align: center; ${isTotalRow ? 'border: 2px solid white; border-left: none; background-color: #333' : ''}">
                    ${formatValue(row.mvar)}
                </td>
                <td class="real-time-exp-imp-data-row-value" style="color: white; font-weight: bold; text-align: center;">
                    ${formatValue(row.volt)}
                </td>
                <td class="real-time-exp-imp-data-row-value" style="color: white; font-weight: bold; text-align: center;">
                    ${formatValue(row.amp)}
                </td>
                <td class="real-time-exp-imp-data-row-value" style="color: white; font-weight: bold; text-align: center;">
                    ${formatValue(row.pf)}
                </td>
            `;

                    realTimeExpImpTbody.appendChild(tr);
                });

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Call fetchData when the page loads
        window.onload = function () {
            fetchData();
            setInterval(fetchData, 2000);
        };
    </script>
</body>

</html>